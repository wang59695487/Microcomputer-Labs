;*****************************************************																								 ;*****************************************************
  RST    EQU  P3.4
  IO     EQU  P3.5
  SCLK   EQU  P3.6	   ;ds1302????
 
  year   DATA 76H	   ;????????
  week   DATA 75H
  month  DATA 74H
  day    DATA 73H
  hour   DATA 72H
  mintue DATA 71H
  second DATA 70H
;*****************************************************
;*****************************************************
//1602??????
  RS EQU P2.6
  RW EQU P2.5 
  E  EQU P2.7 

;*****************************************************
;*****************************************************
  TEMPH EQU 2BH			  ;DS18B20
  TEMPL EQU 2AH
  DAT   EQU P3.7		  ;DAT?18b20???	P1.7 p1.5
;*****************************************************

MAINKEY EQU P1.3		;????p1.5	p1.3
UPKEY	EQU P1.4		;????p1.4	p3.3
DOWNKEY EQU P1.5		;????p1.3	p3.4
SIGN	BIT 22H			;SET TIME/SET RING???,?SIGN=0???SET TIME;?SIGN=0?SET RING
RSIGN   BIT 23H			/*??????,????????,????1,???????29H?????,
                         ??????????,??29H????????????????RSIGNTEMP?
						 ????????????RSIGNTEMP??????,??????1,????3??,
						 ?RSIGNTEMP????1?????????,??????1,????????*/

MKEYVAL    DATA 30H		  ;??????
RHRTEMP	   DATA 33H		  /*;???????????????,??33???????????,
                            ????????????????? ???????????????? */
RMINTEMP   DATA 34H		  /*???????????????*/
RSIGNTEMP  DATA 41H		  /*?????????*/
RINGSIGN   BIT  24H		  /*????,?????????????????,?????????,??????1*/
REMINDSIGN BIT  25H		  /*??????????,?1????????*/
RSTOPKEY   EQU  P3.2	  /*????P3.2*/
RINGFIRST  BIT  26H		  /*????????,??0?????????????????,?????*/
MUNUM      DATA 77H		  /*???????????*/
MUNUMTEMP  DATA 78H		  /*????????*/
TIME0H     DATA 7CH		  /*??????0??????????*/
TIME0L     DATA 7DH		  /*??????0??????????*/
TIME       DATA 7EH		  /*?????????????(??????)*/
FINDNUM    DATA 22H		  /*???????????*/
MUCODTEMP  DATA 7FH		  /*??????????*/
PRONOFSIGN BIT  27H		  /*???????????,?1????,?0??*/
/*???50H-5FH,60-6FH??????1602????????????????*/
;*********************************************************************************************************








;*********************************************************************************************************
  ORG 0000H	
  LJMP START 
  ORG 000BH
  CLR TR0
  CPL P1.6
  MOV TH0,TIME0H
  MOV TL0,TIME0L
  SETB TR0
  RETI


START:
  MOV 79H,#41H	  //????????????A
  MOV 7AH,#41H
  MOV 7BH,#41H
    
  MOV 29H,#00	//29H??????RSIGN??
  MOV SP,#90H	//????
  MOV 23H,#00		//????????,???????
  MOV 50H,#02H		;??"2008"??“2”
  MOV 51H,#00H		;??"2008"??“0”
  MOV MKEYVAL,#00H


  MOV P2,#0FEH		;?????????,???????



  CLR RINGFIRST
  CLR SIGN			 ;???????
  CLR RINGSIGN

  MOV 38H,#00H		 //????????????
  MOV 3AH,#00H		 //????????????

  MOV R0,#35H		 //?????/????????????35H-3CH
  MOV R7,#08
ST1:
  MOV @R0,#00H
  DJNZ R7,ST1							  
  ACALL LCDINT		  ;1602???
  ACALL DS1302INT	  ;1302???
  MOV 32H,#90H
  MOV 31H,#0A5H
  ACALL WR1302

/*????????*/
MAIN0:
  LCALL RINGTEST	  /*????????*/
  JNB RINGSIGN,MAIN	  /*?????????1????????,???????,??????*/
  MOV MKEYVAL,#52 
MAIN:
  MOV A,23H
  CJNE A,#00,MAIN1   
  LCALL MAINKEYTEST	  /*????,????????,????????2*/
  AJMP MAIN2
MAIN1:
  DEC 23H
MAIN2:

  MOV DPTR,#JMPTAB	  /*????,???????DPTR*/
  LCALL RSTOPKEYTEST  /*?????(???????,??????,??)*/
  MOV A,MKEYVAL		  /*???????????????*/
  JMP @A+DPTR
JMPTAB:
  AJMP START1		 ;0?????????
  AJMP JUDGE0		 ;2??,???SETMAIN??
  AJMP SETMAIN		 ;4??SET TIME SET RING ????
  AJMP JUDGE		 ;6??,?????????,?DS1302,??SING,?0?????08,??????;
                     //?1,?32,???????
  AJMP MINSET		 ;8??????
  AJMP JUDGE1		 ;10??????????
  AJMP HRSET		 ;12??????
  AJMP JUDGE2		 ;14??????????
  AJMP WEEKSET		 ;16??????
  AJMP JUDGE3		 ;18??????????
  AJMP DATSET		 ;20?????
  AJMP JUDGE4		 ;22??????????
  AJMP MONSET		 ;24?????
  AJMP JUDGE5		 ;26?????????
  AJMP YEARSET		 ;28?????
  AJMP OUTTOMAIN	 ;30?????0,?????
  AJMP SETONOF		 ;32????ON/OF????
  AJMP JUDGE6		 ;34???????????
  AJMP RHRSET		 ;36????????
  AJMP JUDGE7		  ;38???????????
  AJMP RMINSET		  ;40????????
  AJMP JUDGE8		  ;42????????,????????
  AJMP MUNUMSET		  ;44????????
  AJMP JUDGE9		  ;46???????????????????
  AJMP RDSETONOF	  ;48??????????
  AJMP JUDGE10		  ;50??????,????? 
  AJMP RING		      ;52?????? 
  AJMP PRONOFSET	  ;54????????
;*****************************************************


;*****************************************************
START1:
  MOV 54H,#0FDH	   ;FDH+30H=2DH???"-"
  MOV 57H,#0FDH     ; "-"
  MOV 5AH,#0F0H	    ;F0H+30H=20H?????“ ”
  MOV 5BH,#27H		;+30H?57H	  "W"
  MOV 5CH,#35H		;"e"
  MOV 5DH,#35H		;"e"
  MOV 5EH,#3BH		;"k"
  MOV 62H,#0AH		;":"
  MOV 65H,#0AH		;":"
  MOV 68H,#0F0H		;" "
  MOV 69H,#0F0H		;" "
  MOV 6AH,#0F0H		;" "
  MOV 6CH,#0FEH		;+30H?“.”
  MOV 6EH,#0F2H		;+30H???????"
  MOV 6FH,#13H		;"C" 
STR1:
  ACALL DS1302	    ;??????????????????
  ACALL	DS18B20	    ;???????
  ACALL DISP1602    ;?1602?????????????????????
  AJMP	MAIN0



;??/??????????
SETMAIN:				
  ACALL KEYTEST1  
L3:  
  JNB SIGN,SETST		
  ACALL SETRING
  ACALL SETTIME
  MOV A,#0C4H	  //???????????(????5?)???"SET TIME"
L4:
  LCALL time200ms
  ACALL DISP8B	  //??????????
  LCALL time200ms
  AJMP MAIN
SETST:
  ACALL SETTIME
  ACALL SETRING
  MOV A,#84H	  //???????????(????5?)???"SET RING"
  AJMP L4


;??
MINSET:				  
  LCALL MINS1
  ACALL MINSETKEYTEST
  AJMP MAIN


;??
HRSET:			   
  LCALL HRS1
  LCALL HRSETKEYTEST
  AJMP MAIN


;??
WEEKSET:				
  LCALL WEEKS1
  LCALL WEEKSETKEYTEST
  AJMP MAIN


;??
DATSET:				  
  LCALL DATS1
  LCALL DATSETKEYTEST
  AJMP MAIN


;??
MONSET:				  
  LCALL MONS1
  LCALL MONSETKEYTEST
  AJMP MAIN


;??
YEARSET:				
  LCALL YEARS1
  LCALL YEARSETKEYTEST
  AJMP MAIN



/*????????*/
OUTTOMAIN:
  JB SIGN,OUTTOMAIN2	 //?????????????,SIGN?0?????????????,
                         //SIGN=1,????????????????,?????????
						 //?????????

  MOV R0,#80H	         /*SIGN=0,??DS1302???????*/
  MOV R1,#70H
  MOV R6,#06H
OUTTOMAIN1:
  INC R0		
  INC R0		/*?????R0=82H,??????,?????84H????????????*/
  INC R1		/*?????R1=71H,???????*/
  MOV 32H,R0
  MOV 31H,@R1
  ACALL WR1302	/*??1302??,????*/
  DJNZ R6,OUTTOMAIN1
   MOV 32H,#80H	    ;?ds1302
  MOV 31H,#00H
  ACALL WR1302
  MOV MKEYVAL,#00H
  AJMP MAIN0
OUTTOMAIN2:		  //??????????
  MOV 3BH,mintue
  MOV 3CH,hour
  MOV 3DH,day
  MOV 3EH,month
  MOV 3FH,year
  MOV MKEYVAL,#00H
  AJMP MAIN
  
  
//????ON/OF????
SETONOF:
  MOV 60H,#1FH
  LCALL SETONOFKEYTEST
ONOF3:
  JB RSIGN,SETON
  LCALL SETOF
  AJMP MAIN   
SETON:		   /*????ON?????*/
  MOV 61H,#1EH
  LCALL ONOFS1
  AJMP MAIN



//????????
RHRSET:	
  LCALL RHRS1	  //????????
  LCALL RHRSETKEYTEST	 //????
  LJMP MAIN



/*????????*/
RMINSET:		
  LCALL RMINSETS1
  LCALL RMINSETKEYTEST
  LJMP MAIN


/*????????*/
MUNUMSET:
  LCALL MUNUMS1
  LCALL MUNUMKEYTEST
  AJMP MAIN


//????ON/OF????
RDSETONOF:
  LCALL RDSETONOFKEYTEST   //????
RDONOF3:
  JB REMINDSIGN,RDSETON
  LCALL RDSETOF		   //???OF??
  LJMP MAIN
RDSETON:		   /*??ON?????*/
  MOV 67H,#1EH
  LCALL RDONOFS1
  LJMP MAIN


/*????????*/
RING:
  JB RINGFIRST,NEXT	  //????????????????????,???????
  SETB RINGFIRST
  MOV FINDNUM,#00H	  //???????????00
  MOV TMOD,#01H		  //?????0?1????(16?????)
  SETB ET0			  //?????0??
  SETB EA			  //????
NEXT:
  LCALL MUNUMTEST	  //????????,???????DPTR????????????
  MOV A,FINDNUM
  MOVC A,@A+DPTR	  //?????????

  JZ OUT			  //?????0??0?????????,??????????
  MOV MUCODTEMP,A	  //??0,?????,?????????
  INC FINDNUM
  MOV A,FINDNUM
  MOVC A,@A+DPTR	  //??????????????????

  MOV B,#07			  //???????+7*(??????????)-1,??????
  MUL AB
  ADD A,MUCODTEMP
  DEC A
  MOV MUCODTEMP,A	  //?????????

  INC FINDNUM		  //????????????????,???
  MOV A,FINDNUM
  MOVC A,@A+DPTR
  MOV TIME,A		  
  
  MOV DPTR,#FRQHTAB	  //???????????,???????????TIME0H??????0?TH0
  MOV A,MUCODTEMP
  MOVC A,@A+DPTR
  MOV TIME0H,A
  MOV DPTR,#FRQLTAB	  //???????????TIME0L??????0?TL0
  MOV A,MUCODTEMP
  MOVC A,@A+DPTR
  MOV TIME0L,A
  MOV TH0,TIME0H
  MOV TL0,TIME0L

  SETB TR0			  //????0
  MOV R6,TIME		  //????????,????0????????,???????
  LCALL DEL 		  //???????????
  INC FINDNUM		  //????????,?????????,??????????
  AJMP MAIN
OUT:
  CLR RINGFIRST		  //??????,??RINGFIRST,??????
  AJMP MAIN


/*???????????*/
PRONOFSET:
   lCALL PRKEYTEST
   JB PRONOFSIGN,PRONS1
   LCALL PROFS1
   AJMP MAIN2
PRONS1:
  MOV 6EH,#1EH
  lCALL PRONOFS1
  AJMP MAIN2
PROFS1:
  MOV 6EH,#16H
  lCALL PRONOFS1
  RET






/*PRONOFTEST:
  MOV 32H,#8EH
  MOV 31H,#00H      ;???1302,??????,??7?0,?????
  ACALL WR1302

  MOV 32H,#8BH
  ACALL RD1302
  MOV A,31H
  RLC A
  JC PR1
  CLR PRONOFSIGN 
  RET
PR1:
  SETB PRONOFSIGN
  RET */
;******************************************************



 /*DS1302?LCD1602?DS18B20?????*/
;*****************************************************
//DS1302???(?R6,R0,R1,RD1302?R4)
DS1302:
  MOV R1,#7FH		  ;??DS1302??????
  MOV R0,#6FH 
  MOV R6,#07H
DS13021:
  INC R1
  INC R1
  INC R0		 
  MOV 32H,R1
  ACALL RD1302
  MOV @R0,31H
  DJNZ R6,DS13021	 	 
//????
  MOV R7,year    ;???,?????
  ACALL DIVIDE
  MOV 53H,R3
  MOV 52H,R2
  MOV R7,month   ;???,?????
  ACALL DIVIDE
  MOV 56H,R3
  MOV 55H,R2
  MOV R7,day     ;???,?????
  ACALL DIVIDE
  MOV 59H,R3
  MOV 58H,R2
  MOV R7,week	 ;???,?????
  ACALL DIVIDE
  MOV 5FH,R3
  MOV R7,hour    ;????,?????
  ACALL DIVIDE
  MOV 61H,R3
  MOV 60H,R2
  MOV R7,mintue  ;????,?????
  ACALL DIVIDE
  MOV 64H,R3
  MOV 63H,R2
  MOV R7,second  ;???,?????
  ACALL  DIVIDE
  MOV 67H,R3
  MOV 66H,R2
  RET



//LCD1602???????
DISP1602:
  MOV P0,#80H   ;????????(?1??1???)
  ACALL WRCON  ;?????????
  MOV R6,#10H	;???????? 16?
  MOV R0,#4FH	;??????????
  ACALL DISP16021 ;?????????

  MOV P0,#0C0H  ;????????(????????)
  ACALL WRCON  ;?????????
  MOV R6,#10H
  MOV R0,#5FH
  ACALL DISP16021
  RET
/*??R0??????????-1,R6????????*/
DISP16021:
  INC R0
  MOV A,#30H
  ADD A,@R0
  MOV P0,A
  ACALL LCDDISP
  DJNZ R6,DISP16021
  RET
//LCD1602?????(??????)
LCDDISP:
SETB RS  	
CLR RW          ;RW=0,??????
CLR E           ;E=0,??????
ACALL DELAY     ;??????????
SETB E          ;E=1,????
RET



//DS18B20???????
DS18B20:
  ACALL DS1820INTI
  ACALL RDTEMP
  ACALL	CONVER
  RET
;*****************************************************




/*DS1302???(DS1302?????????????????)*/
;*****************************************************
//DS1302??????
DS1302INT:
  MOV 32H,#8EH
  MOV 31H,#00H      ;???1302,??????,??7?0,?????
  ACALL WR1302

  MOV 32H,#8DH		//???????
  ACALL RD1302
  MOV year,31H
  CLR A
  CJNE A,year,DS1302INT1  //??????00??0:?????;??0?????
  MOV 32H,#0FCH			  //?0,?????????,?
  MOV 31H,#00H			  //?1302??????????????RAM31??00
  LCALL WR1302 
DS1302INT0:
  MOV 32H,#8CH	    ;????????08
  MOV 31H,#08H
  LCALL WR1302
  MOV 32H,#8AH	    ;????????06
  MOV 31H,#06H
  LCALL WR1302
  MOV 32H,#88H	    ;????????07
  MOV 31H,#07H
  LCALL WR1302
  MOV 32H,#86H	    ;????????12
  MOV 31H,#12H
  LCALL WR1302
  MOV 32H,#84H		 ;????????00
  MOV 31H,#00H
  LCALL WR1302
  MOV 32H,#82H		 ;????????00
  MOV 31H,#00H
  LCALL WR1302
  MOV 32H,#80H		 ;????????00
  MOV 31H,#00H
  LCALL WR1302
  AJMP DS1302INT2	 
DS1302INT1:
  MOV 32H,#0FDH		 //?1302RAM31?????????
  LCALL RD1302
  MOV A,31H
  CJNE A,#01H,DS1302INT3 //???1,??????????,?????
  SETB PRONOFSIGN		 //????????????1
  AJMP DS1302INT2
DS1302INT3:
  CLR PRONOFSIGN		 //??1,???????,???????
  AJMP DS1302INT0 
DS1302INT2:
  MOV 32H,#81H			 //??????,??????1302???(????????)
  ACALL RD1302			  //????????
  MOV second,31H
  MOV A,second
  ANL A,#7FH
  MOV second,A
  MOV 32H,#80H	    ;?ds1302
  MOV 31H,second
  ACALL WR1302	
  RET

//?1302??
RD1302:
  CLR SCLK
  NOP
  NOP
  SETB RST
  NOP
  MOV A,32H
  MOV R4,#8
RD13021:
  RRC A      ;????1302
  NOP
  MOV IO,C
  SETB SCLK
  NOP
  CLR SCLK
  NOP
  NOP
  DJNZ R4,RD13021
  MOV R4,#8
RD13022:
  CLR SCLK   ;?1302????? 
  NOP
  MOV C,IO
  NOP
  RRC A
  NOP
  SETB SCLK
  NOP
  DJNZ R4,RD13022
  MOV 31H,A
  CLR RST
  RET

//?1302??
WR1302:
  CLR SCLK
  NOP
  SETB RST
  NOP
  MOV A,32H
  MOV R4,#8
WR13021:
  RRC A     ;????1302
  NOP
  CLR SCLK
  NOP
  MOV IO,C
  NOP
  SETB SCLK
  NOP
  DJNZ R4,WR13021
  CLR SCLK
  NOP
  MOV A,31H
  MOV R4,#8
WR13022:
  RRC A
  NOP       ;????1302
  CLR SCLK
  NOP
  MOV IO,C
  NOP
  SETB SCLK
  NOP
  DJNZ R4,WR13022
  CLR RST
  RET

//??????BCD?????	(R3???,R2????)
DIVIDE:
  MOV A,R7
  ANL A,#0FH
  MOV R3,A
  MOV A,R7
  SWAP A
  ANL A,#0FH
  MOV R2,A
  RET
;*****************************************************




/*LCD1602???(LCD1602???????????????1602??)*/
;*****************************************************
//LCD??????
LCDINT:
  MOV P0,#01H   ;???????
  ACALL WRCON  ;?????????

  MOV P0,#38H   ;??????:8?2?5x7??
  ACALL WRCON  ;?????????

  MOV P0,#06H   ;????,??????
  ACALL WRCON  ;?????????

  MOV P0,#0CH   ;????????????????
  ACALL WRCON  ;?????????
  RET

DISPSET:		 /*??Set,?A??????????*/
  MOV P0,A
  ACALL WRCON
  MOV P0,#53H  ;DISPPLAY "S"
  ACALL LCDDISP	
  MOV P0,#65H	;DISPLAY"e"
  ACALL LCDDISP	
  MOV P0,#74H	  ;DISPLAY"t"
  ACALL LCDDISP
  RET

//?????,?A?????????
DISP2B:
  MOV P0,A; ;????????(?1??5???)
  ACALL WRCON ;?????????
  MOV P0,#20H  ;DISPPLAY " "
  ACALL LCDDISP	
  MOV P0,#20H	;DISPLAY" "
  ACALL LCDDISP	
  RET

//?????,?A?????????
DISP8B:
  ACALL DISP2B
  MOV P0,#20H	  ;DISPLAY" "
  ACALL LCDDISP
  MOV P0,#20H	  ;DISPLAY" "
  ACALL LCDDISP
  MOV P0,#20H	  ;DISPLAY" "
  ACALL LCDDISP
  MOV P0,#20H	   ;DISPLAY" "
  ACALL LCDDISP
  MOV P0,#20H		;DISPLAY" "
  ACALL LCDDISP
  MOV P0,#20H		;DISPLAY" "
  ACALL LCDDISP
  RET

/*??RING N(N=1,2,3)*/
DISPRING:		   
   ACALL SETRING1
   MOV P0,#2DH		;DISPLAY"-"
   ACALL LCDDISP
   MOV A,55H	   //55????N??
   ADD A,#30H	   //?30H,?????????LCD???????
   MOV P0,A
   ACALL LCDDISP
   RET	  
  
//??Set Time
SETTIME:
  MOV A,#84H; ;????????(?1??5???)
  ACALL DISPSET
  MOV P0,#20H	  ;DISPLAY" "
  ACALL LCDDISP
  MOV P0,#54H	  ;DISPLAY"T"
  ACALL LCDDISP 
  MOV P0,#69H	   ;DISPLAY"i"
  ACALL LCDDISP
  MOV P0,#6DH		;DISPLAY"m"
  ACALL LCDDISP
  MOV P0,#65H		;DISPLAY"e"
  ACALL LCDDISP
  RET

//??Set Ring
SETRING:
  MOV A,#0C4H; ;????????(?2??5???)
  ACALL DISPSET
  MOV P0,#20H	  ;DISPLAY" "
  ACALL LCDDISP
SETRING1:
  MOV P0,#52H  ;DISPPLAY "R"
  ACALL LCDDISP	
  MOV P0,#69H	;DISPLAY"i"
  ACALL LCDDISP	
  MOV P0,#6EH	  ;DISPLAY"n"
  ACALL LCDDISP
  MOV P0,#67H	  ;DISPLAY"g"
  ACALL LCDDISP
  RET

;??????
RINGPIC: 
  MOV 54H,#0F0H
  MOV P0,#01H   ;???????
  LCALL WRCON  ;?????????     
  MOV P0,#84H
  LCALL WRCON	 ;?????“RING !!!”
  ACALL SETRING1
  MOV P0,#21H	  //“!”
  LCALL LCDDISP
  MOV P0,#21H	  //“!”
  LCALL LCDDISP
  MOV P0,#21H	  //“!”
  LCALL LCDDISP	

  MOV P0,#0C5H	;???????
  LCALL WRCON
  MOV R0,#5FH	;??????
  MOV R6,#05H
  LCALL DISP16021
  RET


//????????
RDRINGPIC:
  LCALL DS1302
  MOV 54H,#0FDH
  MOV 5BH,#14H		;+30H?44H?D ???5B-5F?Date+??
  MOV 5CH,#31H
  MOV 5DH,#44H		//????????????,?LCD????30H
  MOV 5EH,#35H		//??A?LCD?????41H,?30H,?11H,????????????
  MOV 5FH,#0F0H
  MOV 62H,#0AH		//???62H-6FH?“   : :   Remind”
  MOV 65H,#0F0H
  MOV 66H,#1FH
  MOV 67H,#1EH
  MOV 6AH,#22H
  MOV 6BH,#35H
  MOV 6CH,#3DH
  MOV 6DH,#39H
  MOV 6EH,#3EH
  MOV 6FH,#34H
  LCALL DISP1602
  RET



/*?????????????*/
PRSETPIC:
  MOV 51H,#1FH			 //????????“ Out of battery ”
  MOV 52H,#45H
  MOV 53H,#44H
  MOV 54H,#0F0H
  MOV 55H,#3FH
  MOV 56H,#36H
  MOV 57H,#0F0H
  MOV 58H,#32H
  MOV 59H,#31H
  MOV 5AH,#44H
  MOV 5BH,#44H
  MOV 5CH,#35H
  MOV 5DH,#42H
  MOV 5EH,#49H
  MOV P0,#81H
  ACALL WRCON
  MOV R0,#50H
  MOV R6,#14
  LCALL DISP16021		//????????“ Protection:   ”
  MOV P0,#0C1H
  ACALL WRCON
  MOV 60H,#20H
  MOV 61H,#42H
  MOV 62H,#3FH
  MOV 63H,#44H
  MOV 64H,#35H
  MOV 65H,#33H
  MOV 66H,#44H
  MOV 67H,#39H
  MOV 68H,#3FH
  MOV 69H,#3EH
  MOV 6AH,#0AH
  MOV 6DH,#1FH
  MOV R0,#5FH
  MOV R6,#11
  LCALL DISP16021
  RET




WRCON:
CLR RS          ;??????????
CLR RW
CLR E 
ACALL DELAY
SETB E
RET

DELAY:
MOV P0,#0FFH    ;??????????????
CLR RS
SETB RW
CLR E
NOP
SETB E
JB P0.7,DELAY   ;??P0.7????????????
RET
;*****************************************************




/*DS18B20???(DS18B20????????????????18B20???
???????????????????)*/
;*****************************************************************
//DS18B20?????????????
DS1820INTI:
  ACALL RESET1820		//??18B20
  MOV A,#0CCH			//???ROM????
  ACALL WR1820
  MOV A,#4EH			//???????
  ACALL WR1820
  RET

//?????????
RDTEMP:
  ACALL RESET1820
  MOV A,#0CCH		   //???ROM????
  ACALL WR1820
  MOV A,#44H		   //?????????
  ACALL WR1820
  LCALL TIME1MS
  ACALL RESET1820
  MOV A,#0CCH		   //???ROM????
  ACALL WR1820
  MOV A,#0BEH		   //?????????
  ACALL WR1820
  ACALL RD1820		   //?????????
  MOV TEMPL,A
  ACALL RD1820		   //?????????
  MOV TEMPH,A
  RET

//??DS18B20???
RESET1820:
LA:
  SETB DAT			   
  MOV 42H,#200
LB:
  CLR DAT		  //?????18B20????,????
  DJNZ 42H,LB	  //????480us?????
  SETB DAT
  MOV 42H,#30
LC:
  DJNZ 42H,LC
  CLR C		     //??18B20????????????
  ORL C,DAT
  //JC LB
  MOV 48H,#80
LD:
  ORL C,DAT		 
  JC LP			 //??????????
  DJNZ 48H,LD	 //????,??????
  SJMP LA		 //?????,????
LP:				 //???????,????,????
  MOV 42H,#250
LF:
  DJNZ 42H,LF
  RET

//?DS18B20???????
WR1820:
  MOV 43H,#08
WR18201:
  SETB DAT
  MOV 44H,#08
  RRC A
  CLR DAT
WR18202:
  DJNZ 44H,WR18202
  MOV DAT,C
  MOV 44H,#30
WR18203:
  DJNZ 44H,WR18203
  DJNZ 43H,WR18201
  SETB DAT
  RET

//?DS18B20???????
RD1820:
  CLR EA
  MOV 48H,#08
RD18201:
  CLR DAT
  MOV 44H,#06
  NOP
  SETB DAT
RD18202:
  DJNZ 44H,RD18202
  MOV C,DAT
  RRC A
  MOV 45H,#30
RD18203:
  DJNZ 45H,RD18203
  DJNZ 48H,RD18201
  SETB DAT
  RET

//??????????????????
CONVER:
  MOV A,TEMPL
  ANL A,#0FH
  MOV DPTR,#TABDOT
  MOVC A,@A+DPTR
  MOV 6DH,A
  MOV A,TEMPH
  ANL A,#07H
  MOV 6AH,A
  MOV A,TEMPL
  ANL A,#0F0H
  ORL A,6AH
  SWAP A
  MOV B,#100
  DIV AB
  MOV A,B
  MOV B,#10
  DIV AB
  MOV 6AH,A
  MOV 6BH,B
  RET
//??????
TABDOT: 
  DB	00H,01H,01H,02H,03H,03H,04H,04H,05H,06H,06H,07H,08H,08H,09H,09H
;*************************************************************************






/*???????????????,???????????????????????*/
;*************************************************************************
JUDGE0:
  MOV P0,#01H   ;???????
  ACALL WRCON  ;?????????
  ACALL SETTIME
  ACALL SETRING
  MOV MKEYVAL,#04H
  AJMP MAIN

JUDGE:
  MOV P0,#01H   ;???????
  ACALL WRCON  ;?????????
  JB SIGN,J1
  MOV MKEYVAL,#08H
  ACALL DISP1602
  MOV 32H,#80H	    ;?ds1302
  MOV 31H,#80H
  ACALL WR1302
  AJMP JUDGEOUT

J1:
  MOV RHRTEMP,#36H
  MOV RMINTEMP,#35H
  MOV MUNUMTEMP,#79H
  MOV 55H,#01H		//??????55H??
  MOV 62H,#0F0H	 ;	" "
J11:
  MOV P0,#01H   ;???????
  ACALL WRCON  ;?????????
  MOV MKEYVAL,#32	 //????32???????AJMP SETONOF

  CLR C				  //????????,???RSIGN
  MOV A,RSIGNTEMP
  RRC A
  MOV RSIGNTEMP,A
  MOV RSIGN,C

  MOV R1,RMINTEMP	   //????????????????????????
  MOV mintue,@R1
  MOV R7,mintue		   //???BCD???,??????????????????
  ACALL DIVIDE
  MOV 67H,R3
  MOV 66H,R2

  MOV R1,RHRTEMP	  //????????????????????????
  MOV hour,@R1
  MOV R7,hour
  ACALL DIVIDE
  MOV 64H,R3
  MOV 63H,R2

  MOV R1,MUNUMTEMP	   //???????????????????????
  MOV MUNUM,@R1

  ACALL DISPRING		//??“RING”

  MOV P0,#8AH			//????????????????
  ACALL WRCON

  MOV P0,#4DH			//??“M”
  ACALL LCDDISP
  MOV P0,#75H			//??“u”
  ACALL LCDDISP
  MOV P0,#73H			//??“s”
  ACALL LCDDISP
  MOV P0,#69H			//??“i”
  ACALL LCDDISP
  MOV P0,#63H			//??“c”
  ACALL LCDDISP
  
  MOV P0,#0C2H			//???????????????
  ACALL WRCON

  MOV R0,#61H		   //??62H-67H?6?????????1602
  MOV R6,#06H
  ACALL DISP16021

  MOV P0,#0CBH		   //????????????????
  ACALL WRCON

  MOV P0,#28H		   //??“(”
  ACALL LCDDISP
  MOV P0,MUNUM		   //??????(A?B?C)
  ACALL LCDDISP
  MOV P0,#29H		   //??“)”
  ACALL LCDDISP	 
JUDGEOUT:	
  AJMP MAIN


JUDGE1:
  MOV P0,#0C3H  ;????????(????4???)
  ACALL WRCON  ;?????????
  MOV R0,#62H	 ;??????
  MOV R6,#02H
  ACALL DISP16021
JU1:
  INC MKEYVAL
  INC MKEYVAL
  AJMP MAIN



JUDGE2:
  MOV P0,#0C0H  ;????????(????1???)
  ACALL WRCON  ;?????????
JUDGE21:
  MOV R0,#5FH
  MOV R6,#02H	   
  ACALL DISP16021
  JB SIGN,JUDGE2OUT
  AJMP JU1
JUDGE2OUT:
  MOV MKEYVAL,#20
  AJMP MAIN	  



JUDGE3:
  MOV P0,#8FH  ;????????(?1??16???)
  ACALL WRCON  ;?????????
  MOV A,#30H    ;?????
  ADD A,5FH
  MOV P0,A
  ACALL LCDDISP
  AJMP JU1


JUDGE4:
  MOV P0,#88H  ;????????(?1??9???)
  ACALL WRCON  ;?????????
  MOV R0,#57H	  // ????
  MOV R6,#02H
  ACALL DISP16021
  AJMP JU1 


JUDGE5:
  MOV P0,#85H  ;????????(?1??6???)
  ACALL WRCON  ;?????????
  MOV R0,#54H
  MOV R6,#02H		//?????
  ACALL DISP16021
  AJMP JU1

JUDGE6:
  MOV P0,#0C0H	  	//?????
  ACALL WRCON
  MOV R0,#5FH
  MOV R6,#02H
  ACALL DISP16021
  AJMP JU1
 
JUDGE7:
  MOV P0,#0C3H		 //???????????
  ACALL WRCON
  MOV R0,#62H
  MOV R6,#02H
  ACALL DISP16021
  AJMP JU1

JUDGE8:
  MOV P0,#0C6H		  //??????????
  ACALL WRCON
  MOV R0,#65H
  MOV R6,#02H
  ACALL DISP16021
  AJMP JU1
  
JUDGE9:
  MOV C,RSIGN	   //?????????
  MOV A,29H
  RRC A
  MOV 29H,A

  MOV R1,RHRTEMP	//????????
  MOV @R1,hour
  MOV R1,RMINTEMP
  MOV @R1,mintue
  MOV R1,MUNUMTEMP	 //????????
  MOV @R1,MUNUM

  MOV A,#39H		 
  CJNE A,RMINTEMP,JUDGE92	//???????????????
  MOV A,29H			 //?,???????,???????RSIGNTEMP
  CLR C
  RRC A
  SWAP A
  MOV RSIGNTEMP,A
  MOV 29H,#00H

  ACALL DS1302
  MOV 54H,#0FDH
  MOV 5BH,#14H		;+30H?44H?D ???5B-5F?Date+??
  MOV 5CH,#31H
  MOV 5DH,#44H
  MOV 5EH,#35H
  MOV 5FH,#0F0H
  MOV 62H,#0AH		//???62H-6FH?“   : :   Remind”
  MOV 65H,#0F0H
  MOV 66H,#1FH
  MOV 67H,#16H
  MOV 6AH,#22H
  MOV 6BH,#35H
  MOV 6CH,#3DH
  MOV 6DH,#39H
  MOV 6EH,#3EH
  MOV 6FH,#34H
  ACALL DISP1602
  AJMP JU1	 

JUDGE92:
  INC RHRTEMP		   //????????????????,?????????
  INC RHRTEMP
  INC RMINTEMP
  INC RMINTEMP
  INC MUNUMTEMP
  INC 55H			   //??????
  AJMP J11

JUDGE10:
  MOV P0,#0C6H		   //??????????????ON/OF
  ACALL WRCON
  MOV R0,#65H
  MOV R6,#02H
  ACALL DISP16021
  MOV MKEYVAL,#08H
  AJMP MAIN		

;*************************************************************************
 
 
 
/*????????*/ 
;************************************************************************* 
/*??????*/
MAINKEYTEST:
  JB MAINKEY,MAINKEYTESTOUT
  MOV R7,#50
M1:
  LCALL TIME1MS
  DJNZ R7,M1 
  JNB MAINKEY,$			   /*???????*/
  SETB TR1
  MOV 23H,#01
  INC MKEYVAL
  INC MKEYVAL
  ;LCALL KEYVOICE			   /*????2*/
  RET
MAINKEYTESTOUT:
  MOV 23H,#00
  RET

   
/*SET TIEM/SET RING ??????????,?????????????*/
KEYTEST1:
  JB UPKEY,L1
L2:
  CPL SIGN
  RET
L1:
  JNB DOWNKEY,L2
  RET 


/*??????????*/
MINSETKEYTEST:
  JB UPKEY,MINSET1	 //???????
  JNB UPKEY,$
  MOV A,#09H		 //????????9?
  CJNE A,64H,MINSET2 //??9,?MINSET2,??????  					 
  MOV A,#05H		 //?9,????????5?
  CJNE A,63H,MINSET3 //??5,?MINSET3
  MOV mintue,#00H	 //?5,?????0
  AJMP MINSET4
MINSET3:			 //???9,????5,???????
  MOV A,#06H		 //??MINSET2????,????
  ADD A,mintue
  MOV mintue,A
MINSET2:
  INC mintue
MINSET4:	
  MOV R7,mintue      //????,????? ????
  ACALL DIVIDE
  MOV 64H,R3
  MOV 63H,R2
  RET
MINSET1:			 //???????
  JB DOWNKEY,MINSETKEYTESTOUT
  JNB DOWNKEY,$
  CLR A
  CJNE A,64H,MINSET5
  CLR A
  CJNE A,63H,MINSET6
  MOV mintue,#59H
  LJMP MINSET4
MINSET6:
  CLR C
  MOV A,mintue
  SUBB A,#06H
  MOV mintue,A 
MINSET5:
  DEC mintue
  LJMP MINSET4
MINSETKEYTESTOUT:
  RET

/*??????????*/
HRSETKEYTEST:
  JB UPKEY,HRSET1
  ;ACALL HRS1
  JNB UPKEY,$

  MOV A,#09H
  CJNE A,61H,HRSET0
  MOV A,#06H
  ADD A,hour
  MOV hour,A
  LJMP HRSET2
HRSET0:
  MOV A,#03H
  CJNE A,61H,HRSET2

  MOV A,#02H
  CJNE A,60H,HRSET2
  MOV hour,#00H
  AJMP HRSET4
HRSET2:
  INC hour
HRSET4:
  MOV R7,hour  ;??,????? ??
  LCALL DIVIDE
  MOV 61H,R3
  MOV 60H,R2
  RET
HRSET1:
  JB DOWNKEY,HRSETKEYTESTOUT
  ;ACALL HRS1
  JNB DOWNKEY,$
  CLR A
  CJNE A,61H,HRSET5
  CLR A
  CJNE A,60H,HRSET6
  MOV hour,#23H
  LJMP HRSET4
HRSET6:
  CLR C
  MOV A,hour
  SUBB A,#06H
  MOV hour,A
HRSET5:
  DEC hour
  LJMP HRSET4
HRSETKEYTESTOUT:
  RET


/*?????????*/
WEEKSETKEYTEST:
  JB UPKEY,WEEKSET1
  JNB UPKEY,$
  MOV A,#07H
  CJNE A,5FH,WEEKSET2
  MOV week,#01H
  AJMP WEEKSET3
WEEKSET2:
  INC week
WEEKSET3:	
  MOV 5FH,week
  RET
WEEKSET1:
  JB DOWNKEY,WEEKSETOUT
  JNB DOWNKEY,$
  MOV A,#01H
  CJNE A,5FH,WEEKSET4
  MOV week,#07H
  AJMP WEEKSET3
WEEKSET4:
  DEC week
  AJMP WEEKSET3
WEEKSETOUT:
  RET



/*?????????*/
DATSETKEYTEST:
  JB UPKEY,DATSET1
  JNB UPKEY,$
  MOV A,#09H
  CJNE A,59H,DATSET2
  MOV A,#06H
  ADD A,day
  MOV day,A
  AJMP DATSET3
DATSET2:
  MOV A,#01H
  CJNE A,59H,DATSET3
  MOV A,#03H
  CJNE A,58H,DATSET3
  MOV day,#01H
  AJMP DATSET4
DATSET3:
  INC day
DATSET4:
  MOV R7,day     ;???,?????
  LCALL DIVIDE
  MOV 59H,R3
  MOV 58H,R2
  RET
DATSET1:
  JB DOWNKEY,DATSETOUT
  JNB DOWNKEY,$
  MOV A,#01H
  CJNE A,59H,DATSET5
  CLR A
  CJNE A,58H,DATSET6
  MOV day,#31H
  AJMP DATSET4
DATSET5:
  CLR A
  CJNE A,59H,DATSET6
  CLR C
  MOV A,day
  SUBB A,#06H
  MOV day,A
DATSET6:
  DEC day
  LJMP DATSET4 
DATSETOUT:
  RET
   



/*?????????*/
MONSETKEYTEST:
  JB UPKEY,MONSET1
  JNB UPKEY,$
  MOV A,#09H
  CJNE A,56H,MONSET2
  MOV A,#07H
  ADD A,month
  MOV month,A
  LJMP MONSET4
MONSET2:
  MOV A,#02H
  CJNE A,56H,MONSET3
  MOV A,#01H
  CJNE A,55H,MONSET3
  MOV month,#01H
  AJMP MONSET4
MONSET3:
  INC month
MONSET4:  
  MOV R7,month   ;???,?????
  LCALL DIVIDE
  MOV 56H,R3
  MOV 55H,R2
  RET
MONSET1:
  JB DOWNKEY,MONSETOUT
  JNB DOWNKEY,$
  MOV A,#01H
  CJNE A,56H,MONSET5
  CLR A
  CJNE A,55H,MONSET6
  MOV month,#12H
  LJMP MONSET4
MONSET5:
  CLR A
  CJNE A,56H,MONSET6
  CLR C
  MOV A,month
  SUBB A,#06H
  MOV month,A
MONSET6:
  DEC month
  LJMP MONSET4
MONSETOUT:
  RET


/*?????????*/
YEARSETKEYTEST:
  JB UPKEY,YEARSET1
  JNB UPKEY,$
  MOV A,#09H
  CJNE A,53H,YEARSET2
  MOV A,#09H
  CJNE A,52H,YEARSET3
  MOV year,#00H
  LJMP YEARSET4
YEARSET3:
  MOV A,#06H
  ADD A,year
  MOV year,A
YEARSET2:
  INC year
YEARSET4:    
  MOV R7,year    ;???,?????
  LCALL DIVIDE
  MOV 53H,R3
  MOV 52H,R2
  RET
YEARSET1:
  JB DOWNKEY,YEARSETOUT
  JNB DOWNKEY,$
  CLR A
  CJNE A,53H,YEARSET5
  CLR A
  CJNE A,52H,YEARSET6
  MOV year,#99H
  LJMP YEARSET4
YEARSET6:
  CLR C
  MOV A,year
  SUBB A,#06H
  MOV year,A
YEARSET5:
  DEC year
  LJMP YEARSET4
YEARSETOUT:
  RET


//????ON/OF???????
RDSETONOFKEYTEST:
  JB UPKEY,RDONOF1
RDONOF2:
  CPL REMINDSIGN
  RET
RDONOF1:
  JNB DOWNKEY,RDONOF2
  RET 

/*??/????????????*/
SETONOFKEYTEST:	 
  JB UPKEY,ONOF1
ONOF2:
  CPL RSIGN
  RET
ONOF1:
  JNB DOWNKEY,ONOF2
  RET




//??????????
RHRSETKEYTEST:
  JB UPKEY,RHRSET1
  ;ACALL HRS1
  JNB UPKEY,$

  MOV A,#09H
  CJNE A,64H,RHRSET0
  MOV A,#06H
  ADD A,hour
  MOV hour,A
  LJMP RHRSET2
RHRSET0:
  MOV A,#03H
  CJNE A,64H,RHRSET2

  MOV A,#02H
  CJNE A,63H,RHRSET2
  MOV hour,#00H
  LJMP RHRSET4
RHRSET2:
  INC hour
RHRSET4:
  MOV R7,hour  ;??,????? ??
  LCALL DIVIDE
  MOV 64H,R3
  MOV 63H,R2
  RET
RHRSET1:	   /*???????*/
  JB DOWNKEY,RHRSETKEYTESTOUT
  ;ACALL HRS1
  JNB DOWNKEY,$
  CLR A
  CJNE A,64H,RHRSET5
  CLR A
  CJNE A,63H,RHRSET6
  MOV hour,#23H
  LJMP RHRSET4
RHRSET6:
  CLR C
  MOV A,hour
  SUBB A,#06H
  MOV hour,A
RHRSET5:
  DEC hour
LJMP RHRSET4
RHRSETKEYTESTOUT:
  RET

//??????????
RMINSETKEYTEST:
  JB UPKEY,RMINSET1
  JNB UPKEY,$
  MOV A,#09H
  CJNE A,67H,RMINSET2

  MOV A,#05H
  CJNE A,66H,RMINSET3
  MOV mintue,#00H
  AJMP RMINSET4
RMINSET3:
  MOV A,#06H
  ADD A,mintue
  MOV mintue,A
RMINSET2:
  INC mintue
RMINSET4:	
  MOV R7,mintue  ;????,????? ????
  LCALL DIVIDE
  MOV 67H,R3
  MOV 66H,R2
  RET
RMINSET1:		 /*?????????*/
  JB DOWNKEY,RMINSETKEYTESTOUT
  JNB DOWNKEY,$
  CLR A
  CJNE A,67H,RMINSET5
  CLR A
  CJNE A,66H,RMINSET6
  MOV mintue,#59H
  LJMP RMINSET4
RMINSET6:
  CLR C
  MOV A,mintue
  SUBB A,#06H
  MOV mintue,A 
RMINSET5:
  DEC mintue
  LJMP RMINSET4
RMINSETKEYTESTOUT:
  RET

/*MUSIC??????????*/
MUNUMKEYTEST:
  JB UPKEY,MUNUMSET1
  JNB UPKEY,$
  MOV A,MUNUM
  CJNE A,#43H,MUNUMSET2
  MOV MUNUM,#41H
  RET
MUNUMSET2:
  INC MUNUM
  RET
MUNUMSET1:
  JB DOWNKEY,MUNUMSETOUT
  JNB DOWNKEY,$
  MOV A,MUNUM
  CJNE A,#41H,MUNUMSET3
  MOV MUNUM,#43H
  RET
MUNUMSET3:
  DEC MUNUM
MUNUMSETOUT:
  RET


/*??????????*/
RSTOPKEYTEST:
  JB RSTOPKEY,RSTOPKEYTEST1
  JNB RSTOPKEY,$

  MOV A,MKEYVAL
  CJNE A,#00H,STOPTEST1
  MOV MKEYVAL,#54
  MOV P0,#01H   ;???????
  LCALL WRCON  ;?????????
  LCALL PRSETPIC
  RET
STOPTEST1:
  MOV A,MKEYVAL
  CJNE A,#54,STOPTEST2
  MOV MKEYVAL,#00H
  JB PRONOFSIGN,STRPR
  MOV 32H,#0FCH
  MOV 31H,#00H
  LCALL WR1302 
  RET 
STRPR:
  MOV 32H,#0FCH
  MOV 31H,#01H
  LCALL WR1302                    
  RET

STOPTEST2:
  CLR RINGSIGN
  ;CLR REMINDSIGN
  CLR RINGFIRST
  ;SETB RSTOPSIGN
  MOV MKEYVAL,#00H
  SETB P1.6
  CLR EA
  LCALL DS1302INT2	//???????1302
RSTOPKEYTEST1:
  RET
  

/*????????*/
PRKEYTEST:
  JB UPKEY,PRONOF1
PRONOF2:
  CPL PRONOFSIGN	 //?????????????
  RET
PRONOF1:
  JNB DOWNKEY,PRONOF2
  RET
  	 


/*??????*/
RINGTEST:
  CLR A
  CJNE A,second,RINGTESTOUT	 //????,??0?????,???? 
  JNB REMINDSIGN,RINGTEST0
  MOV R0,#71H		  /*R0??????????,?????????,71H??????????????*/
  MOV R1,#3BH		  /*3BH-3FH???????????????????????*/
  MOV R7,#04H		  /*???????4?,????????????,??????*/
RETESTNEXT:
  MOV A,@R0
  MOV 2EH,@R1		   /*2EH?????*/
  CJNE A,2EH,RINGTEST0
  INC R0
  INC R1
  DJNZ R7,RETESTNEXT
  MOV A,3FH
  CJNE A,year,RINGTEST0		/*????????????????*/
  SETB RINGSIGN
  MOV MUNUM,#00H
  LCALL RDRINGPIC
  MOV MKEYVAL,#52
  RET       
RINGTEST0:			   /*????????*/			   
  MOV A,RSIGNTEMP			 //?????????????????????????????????
  RRC A
  JC RINGTEST1		//?????????
RING2TEST:
  MOV A,RSIGNTEMP
  RRC A
  RRC A
  JC RINGTEST2		 //?????????
RING3TEST:
  MOV A,RSIGNTEMP
  RRC A
  RRC A
  RRC A 
  JC RINGTEST3		//?????????
  RET
RINGTEST1:			//?????????????????????
  MOV R0,#35H
  MOV R1,#71H
  ACALL RTEST
  JNB RINGSIGN,RING2TEST
  MOV MUNUM,79H
  RET
  ;AJMP RING2TEST

RINGTEST2:		    //?????????????????????
  MOV R0,#37H
  MOV R1,#71H
  ACALL RTEST
  JNB RINGSIGN,RING3TEST
  MOV MUNUM,7AH
  ;AJMP RING3TEST
  RET
RINGTEST3:			 //?????????????????????
  MOV R0,#39H
  MOV R1,#71H
  ACALL RTEST
  JNB RINGSIGN,RINGTESTOUT
  MOV MUNUM,7BH
RINGTESTOUT:
  RET

RTEST:			   //???????(R0??????????,R1?????????)
  MOV A,@R0
  MOV 2FH,@R1
  CJNE A,2FH,RTESTOUT
  INC R0
  INC R1

  MOV A,@R0
  MOV 2FH,@R1
  CJNE A,2FH,RTESTOUT	//??????????
  SETB RINGSIGN			//?,??????
  MOV MKEYVAL,#52		//??????52,????????????
  LCALL RINGPIC
RTESTOUT:
  RET


/*???????????*/
MUNUMTEST:
  MOV A,MUNUM
  CJNE A,#41H,MUNUMTESTNEXT	//??MUNUM??41H,??????A
  MOV DPTR,#MUSICTAB2
  RET
MUNUMTESTNEXT:
  CJNE A,#42H,MUNUMTESTNEXT1  //??MUNUM??41H,??????B
  MOV DPTR,#MUSICTAB3
  RET
MUNUMTESTNEXT1:
  CJNE A,#43H,MUNUMTESTOUT	//??MUNUM??41H,??????C
  MOV DPTR,#MUSICTAB4
  RET
MUNUMTESTOUT:				//???????????,??????
  MOV DPTR,#MUSICTAB
  RET

;**************************************************************




/*?????*/
;**************************************************************
;???? 
MINS1:
  MOV R5,#0C3H	;???????? 
  MOV R4,#62H	;????????????????
  ACALL S1
  RET

;????
HRS1:
  MOV R5,#0C0H
  MOV R4,#5FH
  ACALL S1
  RET

;????
WEEKS1:
  MOV P0,#8FH   ;????????(?1??16???)
  LCALL WRCON  ;?????????

  MOV A,#30H    ;?????
  ADD A,5FH
  MOV P0,A
  LCALL LCDDISP
  ACALL time200ms

  MOV P0,#8FH   ;????????(?1??16???)
  LCALL WRCON  ;?????????

  MOV P0,#20H	  ;DISPLAY" "
  LCALL LCDDISP
  ACALL time200ms
  RET


;????
DATS1:
  MOV R5,#88H
  MOV R4,#57H
  ACALL S1
  RET

;????
MONS1:
  MOV R5,#85H
  MOV R4,#54H
  ACALL S1
  RET


;????
YEARS1:
  MOV R5,#82H
  MOV R4,#51H
  ACALL S1
  RET

/*???????*/
S1:
  MOV P0,R5   ;????????
  LCALL WRCON  ;?????????
  MOV A,R4
  MOV R0,A	   
  MOV R6,#02H  ;??????????
  LCALL DISP16021
  ACALL time200ms
  MOV A,R5
  LCALL DISP2B
  ACALL time200ms
  RET



RDONOFS1:		   /*????ON/OF??????*/
  MOV P0,#0C6H
  LCALL WRCON

  MOV R0,#65H
  MOV R6,#02H
  LCALL DISP16021
  ACALL time200ms
  MOV A,#0C6H
  LCALL DISP2B

  ACALL time200ms
  RET

RDSETOF:		  /*????OF?????*/
  MOV 67H,#16H
  ACALL RDONOFS1
  RET

SETOF:		   /*????OF?????*/
  MOV 61H,#16H
  ACALL ONOFS1
  RET

ONOFS1:			/*????ON/OF????*/
  MOV P0,#0C0H
  LCALL WRCON

  MOV R0,#5FH
  MOV R6,#02H
  LCALL DISP16021

  ACALL time200ms

  MOV A,#0C0H
  LCALL DISP2B

  ACALL time200ms
  RET

RHRS1:		   /*????????*/
  MOV R5,#0C3H	 
  MOV R4,#62H
  ACALL S1
  RET

RMINSETS1:		/*????????*/
  MOV R5,#0C6H
  MOV R4,#65H
  ACALL S1
  RET

MUNUMS1:		/*????????*/
  MOV 6CH,MUNUM
  MOV P0,#0CCH
  LCALL WRCON
  MOV P0,6CH
  LCALL LCDDISP
  ACALL time200ms
  MOV P0,#0CCH
  LCALL WRCON
  MOV P0,#20H
  LCALL LCDDISP
  ACALL time200ms
  RET

PRONOFS1:           /*????ON/OF????*/            
  MOV P0,#0CDH
  LCALL WRCON
  MOV R0,#6CH
  MOV R6,#02H
  LCALL DISP16021
  ACALL time200ms
  MOV A,#0CDH
  LCALL DISP2B
  ACALL time200ms
  RET

;*****************************************************




/*???????*/
;*****************************************************
FRQHTAB:
  DB  0F2H,0F3H,0F5H,0F5H,0F6H,0F7H,0F8H //1,2,3,4,5,6,7,8,i
  DB  0F9H,0F9H,0FAH,0FAH,0FBH,0FBH,0FCH
  DB  0FCH,0FCH,0FDH,0FDH,0FDH,0FDH,0FEH
  DB  0FEH,0FEH,0FEH,0FEH,0FEH,0FEH,0FFH
FRQLTAB:
  DB  42H,0C1H,17H,0B6H,0D0H,0D1H,0B6H//1,2,3,4,5,6,7,8,i
  DB  21H,0E1H,8CH,0D8H,68H,0E9H,5BH
  DB  8FH,0EEH,44H,6BH,0B4H,0F4H,2DH 
  DB  47H,77H,0A2H,0B6H,0DAH,0FAH,16H

/*???????*/
MUSICTAB:
    DB     6,2,3,      5,2,1,      3,2,2, 5,2,2, 1,3,2, 6,2,1, 5,2,1,6,2,4 
    DB     3,2,2,      5,2,1,      6,2,1, 5,2,2, 3,2,2, 1,2,1
    DB     6,1,1,      5,2,1,      3,2,1, 2,2,4, 2,2,3, 3,2,1, 5,2,2
    DB     5,2,1,      6,2,1,      3,2,2, 2,2,2, 1,2,4, 5,2,3, 3,2,1
    DB     2,2,1,      1,2,1,      6,1,1, 1,2,1, 5,1,6, 0,0,0 

/*?????????*/
MUSICTAB2:
  DB  3,2,2, 3,2,1, 4,2,1, 3,2,2, 2,2,1, 1,2,1, 2,2,2
  DB  5,2,1, 2,2,2, 2,2,3, 1,2,2, 1,2,1, 2,2,1, 1,2,2
  DB  7,1,1, 6,1,1, 7,1,2, 3,2,1, 7,1,1, 7,1,3, 6,1,2
  DB  2,2,1, 3,2,1, 2,2,1, 1,2,1, 6,1,2, 5,1,2, 2,2,1
  DB  3,2,1, 2,2,1, 1,2,2, 6,1,3, 6,1,2, 2,2,1, 3,2,1
  DB  2,2,1, 1,2,1, 6,1,1, 1,2,1, 1,2,5, 0,0,0

/*???*/
MUSICTAB3:
  DB  3,2,2, 6,2,1, 3,2,2, 3,2,1, 5,2,1, 6,2,1, 6,2,2
  DB  6,2,1, 6,2,1, 1,3,1, 6,2,1, 5,2,1, 6,2,1, 5,2,1, 3,2,1
  DB  2,2,1, 3,2,2, 6,1,2, 3,2,1, 2,2,2, 2,2,2, 3,2,1
  DB  6,2,1, 6,2,1, 1,2,2, 1,2,1, 3,2,1, 6,2,1, 6,2,1, 3,2,1
  DB  6,2,1, 7,2,2, 7,2,4, 3,2,2, 6,2,1, 3,2,2, 3,2,1
  DB  5,2,1, 6,2,1, 6,2,2, 6,2,1, 6,2,1, 1,3,1, 6,2,1
  DB  5,2,1, 6,2,1, 5,2,1, 3,2,1, 2,2,1, 3,2,1, 6,1,1
  DB  3,2,1, 2,2,2, 2,2,2, 3,2,1, 3,2,2, 3,2,1, 6,1,2, 6,1,1
  DB  7,1,1, 7,1,1, 7,1,1, 2,2,1, 1,2,1, 7,1,2, 6,1,1
  DB  6,1,2, 0,0,0

/*??*/
MUSICTAB4:
  DB  6,1,2, 6,1,1, 6,1,1, 5,1,1, 6,1,1, 1,2,1, 1,2,1
  DB  2,2,1, 3,2,1, 1,2,1, 2,2,1, 2,2,2, 1,2,1, 6,1,2
  DB  6,1,1, 1,2,1, 1,2,1, 1,2,1, 2,2,1, 1,2,1, 6,1,1
  DB  2,1,1, 3,1,1, 5,1,1, 5,1,1, 3,1,2, 3,1,2, 3,1,1
  DB  5,1,1, 6,1,1, 1,2,1, 2,2,1, 6,1,2, 5,1,1, 6,1,1
  DB  1,2,1, 6,1,1, 3,1,1, 2,1,2, 1,1,1, 1,1,1, 2,1,1
  DB  3,1,1, 5,1,1, 6,1,1, 2,2,1, 1,2,1, 5,1,1, 1,2,1
  DB  6,1,2, 6,1,2, 1,1,1, 1,1,1, 2,1,1, 3,1,1, 5,1,1
  DB  6,1,1, 2,2,1, 2,2,1, 2,2,1, 3,2,1, 2,2,1, 1,2,1
  DB  6,1,1, 3,1,1, 5,1,1, 5,1,1, 1,2,1, 1,2,1, 1,2,2
  DB  6,1,3, 6,1,3, 0,0,0 

/*??*/
MUSICTAB5:
  DB  5,1,1, 5,2,1, 4,2,1, 3,2,2, 3,2,1, 4,2,1, 3,2,2
  DB  3,2,1, 4,2,1, 3,2,1, 4,2,1, 3,2,1, 2,2,1, 1,2,1
  DB  1,2,1, 3,2,1, 5,2,1, 6,2,2, 6,2,1, 6,2,1, 5,2,1
  DB  2,2,1, 2,2,1, 4,2,1, 3,2,1, 3,2,3, 1,2,1, 3,2,1
  DB  5,2,1, 6,2,1, 6,2,2, 6,2,1, 5,2,1, 5,2,1, 2,2,1
  DB  2,2,1, 4,2,1, 3,2,1, 4,2,1, 3,2,1, 1,2,1, 2,2,1
  DB  3,2,1, 6,1,1, 6,1,1, 1,2,1, 1,2,2, 7,1,2, 1,2,3, 0,0,0 
;*****************************************************




;*****************************************************
/*KEYVOICE:
  CLR P1.6
  ACALL time100ms
  SETB P1.6
  RET	  */

//???????
DEL:
  ACALL time200ms
  ACALL time200ms
  DJNZ R6,DEL
  CLR TR0
  RET

TIME1MS:
  MOV R3,#0FAH                 
TIME1MS_1:
  NOP   
  NOP   
  DJNZ R3,TIME1MS_1    
  RET
;??100mS    
;*****************************************************************    
   
time100ms:              mov     r5,#0c3h        ;100.036ms    
time100ms_1:            mov     r6,#0ffh        ;511us    
                        djnz    r6,$    
                        djnz    r5,time100ms_1    
                        ret  
time200ms:
  MOV R7,#200
time1:
  ACALL TIME1MS
  DJNZ R7,time1
  RET
  
     
END   
;*********************************************************************************************************************************
 //???CLR REMIDNSIGN
  //???SP????
  //??RINGTEST????RING2 RING3?RRC A,?RING2?????RRC A,?RING2?????
  //7.16 ????????????
  //7.17 ??????????/????